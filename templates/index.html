{% extends 'base.html' %}

{% block title %}MCP Assessor Agent API{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto text-center mb-5">
        <h1 class="display-4 mb-4">MCP Assessor Agent API</h1>
        <p class="lead mb-4">
            A sophisticated intermediary service for secure and intelligent multi-database querying,
            focusing on real estate property data management with cutting-edge security and processing capabilities.
        </p>
        <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
            <a href="/api-docs" class="btn btn-primary btn-lg px-4 gap-3">API Documentation</a>
            <a href="/api/docs" class="btn btn-outline-secondary btn-lg px-4" target="_blank">OpenAPI Spec</a>
        </div>
    </div>
</div>

<div class="row mb-5">
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <h3 class="card-title">Secure Querying</h3>
                <p class="card-text">
                    Our API offers robust protection against SQL injection through parameterized queries and
                    multi-layered security mechanisms including rate limiting and API key authentication.
                </p>
            </div>
            <div class="card-footer bg-transparent border-0">
                <a href="/api-docs#parameterized-queries" class="btn btn-sm btn-outline-primary">Learn More</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <h3 class="card-title">Natural Language</h3>
                <p class="card-text">
                    Translate English queries into SQL with our OpenAI-powered natural language processing integration,
                    making database interactions accessible to non-technical users.
                </p>
            </div>
            <div class="card-footer bg-transparent border-0">
                <a href="/api-docs#natural-language" class="btn btn-sm btn-outline-primary">Learn More</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <h3 class="card-title">Schema Discovery</h3>
                <p class="card-text">
                    Automatically discover and explore database schemas to understand the structure of available data
                    for improved query construction and data analysis.
                </p>
            </div>
            <div class="card-footer bg-transparent border-0">
                <a href="/api-docs#schema" class="btn btn-sm btn-outline-primary">Learn More</a>
            </div>
        </div>
    </div>
</div>

<div class="row mb-5">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="m-0">Sample Query</h3>
            </div>
            <div class="card-body">
                <div class="code-block mb-3">
<pre><code>// Execute a parameterized query
const response = await fetch('/api/parameterized-query', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-API-Key': 'your_api_key'
    },
    body: JSON.stringify({
        db: 'postgres',
        query: 'SELECT * FROM parcels WHERE city = :city LIMIT :limit',
        params: {
            city: 'Seattle',
            limit: 10
        },
        param_style: 'named'
    })
});

const data = await response.json();</code></pre>
                </div>
                <a href="/api-docs#try-it" class="btn btn-primary">Try It Out</a>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3 class="m-0">Natural Language to SQL</h3>
            </div>
            <div class="card-body">
                <div class="code-block mb-3">
<pre><code>// Convert natural language to SQL
const response = await fetch('/api/nl-to-sql', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-API-Key': 'your_api_key'
    },
    body: JSON.stringify({
        db: 'postgres',
        prompt: 'Find all properties in Seattle with at least 3 bedrooms built after 2000'
    })
});

const translation = await response.json();</code></pre>
                </div>
                <a href="/api-docs#natural-language" class="btn btn-primary">Learn More</a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="m-0">Data Visualization Example</h3>
            </div>
            <div class="card-body">
                <div id="chart-container" style="height: 400px;">
                    <div class="d-flex justify-content-center align-items-center h-100">
                        <p class="text-center text-muted">
                            <span>Interactive data visualization will be displayed here</span><br>
                            <small>(Requires API key and active database connection)</small>
                        </p>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <form id="visualization-form" class="row g-3">
                    <div class="col-md-4">
                        <label for="city-select" class="form-label">City</label>
                        <select id="city-select" class="form-select">
                            <option value="Seattle">Seattle</option>
                            <option value="Portland">Portland</option>
                            <option value="San Francisco">San Francisco</option>
                            <option value="Los Angeles">Los Angeles</option>
                            <option value="New York">New York</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="year-select" class="form-label">Assessment Year</label>
                        <select id="year-select" class="form-select">
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="api-key-input" class="form-label">API Key</label>
                        <input type="password" id="api-key-input" class="form-control" placeholder="Enter API key to view data">
                    </div>
                    <div class="col-12 text-end">
                        <button type="submit" class="btn btn-primary">Update Visualization</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('visualization-form');
        
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const citySelect = document.getElementById('city-select');
            const yearSelect = document.getElementById('year-select');
            const apiKeyInput = document.getElementById('api-key-input');
            
            const chartContainer = document.getElementById('chart-container');
            
            // Display loading state
            chartContainer.innerHTML = `
                <div class="d-flex justify-content-center align-items-center h-100">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            `;
            
            // Simulate API call delay
            setTimeout(() => {
                if (!apiKeyInput.value) {
                    chartContainer.innerHTML = `
                        <div class="d-flex justify-content-center align-items-center h-100">
                            <div class="alert alert-warning" role="alert">
                                Please enter an API key to view data visualization.
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Mock data visualization message
                chartContainer.innerHTML = `
                    <div class="d-flex justify-content-center align-items-center h-100">
                        <div class="alert alert-info" role="alert">
                            <p>Data visualization for ${citySelect.value} (${yearSelect.value}) would be displayed here.</p>
                            <p class="mb-0">Real implementation requires connection to the FastAPI backend.</p>
                        </div>
                    </div>
                `;
            }, 1000);
        });
    });
</script>
{% endblock %}